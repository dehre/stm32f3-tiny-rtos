//==================================================================================================
// INCLUDES
//==================================================================================================

#include "os_timer.h"

#include "iferr.h"

//==================================================================================================
// DEFINES - MACROS
//==================================================================================================

//==================================================================================================
// ENUMS - STRUCTS - TYPEDEFS
//==================================================================================================

//==================================================================================================
// STATIC PROTOTYPES
//==================================================================================================

//==================================================================================================
// STATIC VARIABLES
//==================================================================================================

static TIM_HandleTypeDef TIMHandle;

//==================================================================================================
// GLOBAL FUNCTIONS
//==================================================================================================

// TODO LORIS: adjust values
void OSTimer_Init(void)
{
    /* Compute the prescaler value to have TIM2 counter clock equal to 10 KHz */
    uint32_t uwPrescalerValue = (SystemCoreClock / 10000) - 1;
    TIMHandle.Instance = OSTimer_Instance;
    TIMHandle.Init.Period = 10000 - 1;
    TIMHandle.Init.Prescaler = uwPrescalerValue;
    TIMHandle.Init.ClockDivision = 0;
    TIMHandle.Init.CounterMode = TIM_COUNTERMODE_DOWN;
    TIMHandle.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
    IFERR_PANIC(HAL_TIM_Base_Init(&TIMHandle));
}

void OSTimer_Start(void)
{
    IFERR_PANIC(HAL_TIM_Base_Start_IT(&TIMHandle));
}

void OSTimer_ClearITFlag(void)
{
    __HAL_TIM_CLEAR_IT(&TIMHandle, TIM_IT_UPDATE);
}

//==================================================================================================
// STATIC FUNCTIONS
//==================================================================================================
